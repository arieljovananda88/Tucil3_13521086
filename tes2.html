<!DOCTYPE html>
<html>
  <head>
    <title>Graph Visualization</title>
    <style type="text/css">
      #mynetwork {
        width: 600px;
        height: 400px;
        margin: 0 auto;
        border: 1px solid lightgray;
      }
    </style>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="tes.js"></script>
  </head>
  <body>
    <input type="file" id="file-input">
    <div id="mynetwork"></div>
    <script>
      const fileInput = document.getElementById('file-input');
      fileInput.addEventListener('change', handleFileSelect);

      function handleFileSelect(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = handleFileLoad;
        reader.readAsText(file);
      }

      let graph, vertices, vertices2, nodeCoordinates, matrix, nodes

      function handleFileLoad(event) {
        console.log(event.target.result)
        const input = event.target.result;
        const inputLines = input.split('\n').map(line => line.trim());
        const amountOfCoor = parseInt(inputLines[0]);

        // parse the node coordinates
        nodeCoordinates = {};
        for (let i = 1; i < amountOfCoor + 1; i++) {
          if (i == 0) {
            continue;
          } else {
            const [node, x, y] = inputLines[i].split(' ');
            nodeCoordinates[node] = { x: parseInt(x), y: parseInt(y) };
          }
        }

        const matrixLine = 2 + amountOfCoor;
        const columnLabels = inputLines[matrixLine].split(' ');
        const rowLabels = inputLines.slice(matrixLine + 1).map(line => line.split(' ')[0]);
        graph = {};
        matrix = input
          .split('\n')
          .slice(matrixLine + 1)
          .map(row => row.trim().split(/\s+/).slice(1).map(num => String(num)))

        columnLabels.forEach(vertex => graph[vertex] = {});
        vertices = rowLabels;
        vertices2 = columnLabels;

        nodes = Object.keys(nodeCoordinates).map(node => ({ id: node, label: node }));
        for (let i = 0; i < rowLabels.length; i++) {
            const sourceNode = rowLabels[i];
            for (let j = 0; j < columnLabels.length; j++) { // Change to < instead of <=
                const road = matrix[i][j].toString();
                if (road != "0") { // Change to "0" instead of 0
                const targetNode = columnLabels[j];
                // add the target node to the graph object if it doesn't exist yet
                if (!graph[targetNode]) {
                    graph[targetNode] = {};
                }
                graph[sourceNode][targetNode] = road;
                }
            }
        }
        visualize()
      }

      function runUCS(event) {
        console.log(graph, vertices, nodeCoordinates)
        const endPath = UCS("B", "H", graph, vertices, nodeCoordinates);
        let road = endPath.road
        let count = 0
        let count2 = 0
        console.log(road.length)
        console.log(matrix)
        for(let i = 0; i < matrix.length; i++){
            for(let j = 0; j < matrix.length; j++){
                for(let k = 0; k < road.length; k++){
                    if(road[k] == matrix[i][j]){
                        matrix[i][j] = "+" + matrix[i][j]
                    }
                }
            }
        }
        visualize()
    }

    function visualize(){
        const visited = {}
        const edges = []
        for (let i = 0; i < matrix.length; i++) {
            for (let j = 0; j < matrix[i].length; j++) {
                if(matrix[i][j].startsWith("+")){
                    if(visited[matrix[i][j]] != true){
                        edges.push({ from: vertices[i], to: vertices2[j], label: matrix[i][j].substring(1), color: {color: "red"}});
                    }
                    visited[matrix[i][j]] = true
                }
                if (matrix[i][j] != 0) {
                    if(visited[matrix[i][j]] != true){
                        edges.push({ from: vertices[i], to: vertices2[j], label: matrix[i][j], color: {color: "blue"}});
                    }
                    visited[matrix[i][j]] = true
                }
            }
        }
        console.log(edges)
        const container = document.getElementById('mynetwork');
        const data = { nodes, edges };
        const options = {};
        const network = new vis.Network(container, data, options);
    }


    </script>
    <button onclick="runUCS(event)">Run UCS</button>
  </body>
</html>
